function setTagInput(elementId, type, id){
	if(type != null && type != ""
		&& id != null && id != "" ){
		$.ajax({
			url : contextPath +"/commonTag/getCommonTagList.do",
			data : {
				type : type,
				id : id
			},
			type: "POST",
			async: false,
			success : function(ret)
			{
				if(ret.commonTagList != null || ret.commonTagList.length != 0) {
					var tagValue = "";
					for(i = 0 ; i < ret.commonTagList.length ; ++i){
						tagValue += ret.commonTagList[i].tagTitle;
						if(i < ret.commonTagList.length-1){
							tagValue += ",";
						}
					}
					$("#"+elementId).val(tagValue);
				}
				
				initTagInput(elementId);
			},
			error : function(request, err, ex)
			{
			}
		});
	} else{
		initTagInput(elementId);
	}

}

function initTagInput(elementId){
	$.ajax({
		url : contextPath +"/commonTag/getCommonTagList.do",
		data : {
			type : null,
			id : null
		},
		type: "POST",
		async: false,
		success : function(ret)
		{
			var tagList = new Array();
			
			for(i = 0 ; i < ret.commonTagList.length ; ++i){
				tagList.push(ret.commonTagList[i].tagTitle);
			}
			
			$('#'+elementId).tagator({
			    prefix: 'tagator_',           // CSS class prefix
			    height: 'auto',               // auto or element
			    useDimmer: false,             // dims the screen when result list is visible
			    showAllOptionsOnFocus: false, // shows all options even if input box is empty
			    allowAutocompleteOnly: false, // only allow the autocomplete options
			    autocomplete: tagList              // this is an array of autocomplete options
			});
			
			$('#'+elementId).on("change", function (){
				var tags = $(".tagator_tag");
				if(tags.length <= 0 ) return;
				else if(tags.length >= 5){
					$(".tagator_input").attr('maxlength','0');
				}else {
					$(".tagator_input").attr('maxlength','');
				}
			});
			
			$('.tagator_input').on("focusout", function (){
				var inputVal = $(".tagator_input").val();
				if(inputVal.length > 0){
					addTagFunction(inputVal);
				}
			});
		},
		error : function(request, err, ex)
		{
		}
	});
}

function saveTags(elementId, type, id, callback){
	var inputVal = $(".tagator_input").val();
	if(inputVal.length > 0){
		addTagFunction(inputVal);
	}
	
	$.ajax({
		url : contextPath +"/commonTag/saveTags.do",
		type : "POST",
		data : {
			id : id,
			type : type,
			tags : $('#'+elementId).val()
		},
		async: false,
		success : function(ret)
		{
			if(callback != null){
				callback();
			}
		},
		error : function(request, err, ex)
		{
		}
	});
}

function getTagList(tagElementId, type, id){
	$.ajax({
		url : contextPath +"/commonTag/getCommonTagList.do",
		data : {
			type : type,
			id : id
		},
		type: "POST",
		async: false,
		success : function(ret)
		{
			drawTagList(tagElementId, ret.commonTagList);
		},
		error : function(request, err, ex)
		{
		}
	});
}

function drawTagList(tagElementId, tagList){
	if(tagList == null || tagList.length == 0) return;
	var result = "";
	for(i=0; i < tagList.length ; ++i){
		result += "<span><a href='javascript:;' onclick='onClickTag(\""+tagList[i].tagId+"\",\""+tagList[i].tagTitle+"\")'>";
		result += "#"+tagList[i].tagTitle;
		result += "</a></span>"
	}
	
	$("#"+tagElementId).append(result);
}

function onClickTag(tagId, tagTitle){
	//document.tagForm.tagId.value=tagId;
	//document.tagForm.tagTitle.value=tagTitle;
	//document.tagForm.submit();
	//alert("TBD");
}